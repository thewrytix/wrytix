<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>View User - Wrytix Admin</title>
  <link rel="stylesheet" href="../../backend-panel.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
      --primary: #ff6b00;
      --danger: #d9534f;
      --success: #28a745;
      --text-dark: #333;
      --text-light: #fff;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background-color: #f4f4f4;
      display: flex;
    }

    .admin-sidebar {
      width: 250px;
      background: #222;
      color: white;
      min-height: 100vh;
      padding: 1rem;
    }

    .admin-sidebar h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    .admin-sidebar ul {
      list-style: none;
      padding: 0;
    }

    .admin-sidebar li {
      margin: 0.5rem 0;
    }

    .admin-sidebar a {
      color: white;
      text-decoration: none;
      padding: 0.4rem 0.6rem;
      display: block;
      border-radius: 4px;
    }

    .admin-sidebar a.active,
    .admin-sidebar a:hover {
      background-color: var(--primary);
    }

    .admin-main {
      flex-grow: 1;
      padding: 2rem;
      background: #fff;
      margin: 2rem auto;
      border-radius: 12px;
      max-width: 700px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    #userDetails {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 500px;
      font-size: 1rem;
      line-height: 1.6;
      color: #333;
    }

    #userDetails img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 0.5rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    #userDetails a.download-avatar {
      margin-bottom: 1rem;
      font-size: 0.9rem;
      color: var(--primary);
      text-decoration: underline;
    }

    #userDetails p {
      width: 100%;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
    }

    #userDetails p strong {
      color: var(--text-dark);
    }

    .alert {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      border-radius: 5px;
      font-weight: 600;
      font-size: 1rem;
      color: #fff;
      z-index: 9999;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      animation: slideIn 0.3s ease-out;
    }

    .alert.error {
      background: #dc3545;
    }

    @keyframes slideIn {
      from { top: -50px; opacity: 0; }
      to { top: 20px; opacity: 1; }
    }

    .back-button {
      margin-top: 2rem;
    }

    .back-button button {
      background-color: var(--primary);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s ease;
    }

    .back-button button:hover {
      background-color: #e05c00;
    }

    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }

      .admin-sidebar {
        width: 100%;
        min-height: auto;
      }

      .admin-main {
        margin: 1rem;
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
<aside class="admin-sidebar">
  <h2>Wrytix Admin</h2>
  <nav>
    <ul>
      <!--Admin Management-->
      <li><a href="../admin-dashboard.html" >Admin Dashboard</a></li>

      <!--Post Management-->
      <li class="dropdown open">
        <button class="dropdown-toggle">Post Management ‚ñº</button>
        <ul class="dropdown-menu">
          <li><a href="../post-management/post-dashboard.html">Post Dashboard</a></li>
          <li><a href="../post-management/posts-list.html">Posts List</a></li>
          <li><a href="../post-management/add-post.html" >Add Post</a></li>
          <li><a href="../post-management/delete-post.html">Delete Posts</a></li>
          <li><a href="../post-management/post-approval-requests.html" >Post Approval Requests</a></li>
        </ul>
      </li>
      <!--Ad Management-->
      <li class="dropdown open">
        <button class="dropdown-toggle">Ad Management ‚ñº</button>
        <ul class="dropdown-menu">
          <li><a href="../ad-management/ads-dashboard.html">Ad Dashboard</a></li>
          <li><a href="../ad-management/add-ad.html">Add Ad</a></li>
          <li><a href="../ad-management/ads-list.html">Ads List</a></li>
          <li><a href="../ad-management/delete-ad.html">Delete Ad</a></li>
        </ul>
      </li>
      <!--User Management-->
      <li class="dropdown open">
        <button class="dropdown-toggle">User Management ‚ñº</button>
        <ul class="dropdown-menu">
          <li><a href="user-dashboard.html">User Dashboard</a></li>
          <li><a href="add-user.html" >Add User</a></li>
          <li><a href="users-list.html">Users List</a></li>
          <li><a href="delete-user.html">Delete User</a></li>
          <li><a href="user-approval-requests.html">Approval Requests</a></li>
          <li><a href="logs.html">Logs</a></li>
        </ul>
      </li>
    </ul>
  </nav>
</aside>

<div class="admin-main">
  <div class="top-bar">
    <div class="profile-dropdown">
      <button class="profile-btn" id="profileBtn">Loading...</button>
      <div class="profile-menu" id="profileMenu">
        <button id="logoutBtn">üö™ Logout</button>
      </div>
    </div>
  </div>

  <h1>View User</h1>
  <div id="userDetails">Loading user info...</div>

  <div class="back-button">
    <button onclick="window.location.href='users-list.html'">
      ‚Üê Back to Users List
    </button>
  </div>
</div>

<script>
  // Session verification
  window.onload = async () => {
    try {
      const sessionCheck = await fetch('https://wrytix.onrender.com/verify-session', {
        credentials: 'include'
      });

      if (!sessionCheck.ok) throw new Error('Session verification failed');

      const { user } = await sessionCheck.json();

      sessionStorage.setItem('currentUser', user.username);
      sessionStorage.setItem('role', user.role);
      sessionStorage.setItem('userRole', user.role);
      sessionStorage.setItem('loggedIn', 'true');

      if (user.role !== 'admin') {
        showError('You do not have permission to access this page.');
        sessionStorage.clear();
        return window.location.href = 'login.html';
      }
    } catch (err) {
      console.error('Initialization error:', err);
      sessionStorage.clear();
      window.location.href = 'login.html';
    }
  };

  const params = new URLSearchParams(window.location.search);
  const userId = params.get('id');

  async function loadUser() {
    try {
      const res = await fetch(`https://wrytix.onrender.com/users/${userId}`);
      if (!res.ok) throw new Error('Failed to fetch user');
      const user = await res.json();

      const container = document.getElementById('userDetails');
      const avatarHTML = user.avatar
              ? `<img src="${user.avatar}" alt="Avatar" />
           <a href="${user.avatar}" download="avatar-${user.username}.png" class="download-avatar">Download Avatar</a>`
              : `<img src="default-avatar.png" alt="Default Avatar" />`;

      container.innerHTML = `
        ${avatarHTML}
        <p><strong>Full Name:</strong> ${user.fullName}</p>
        <p><strong>Username:</strong> ${user.username}</p>
        <p><strong>Email:</strong> ${user.email}</p>
        <p><strong>Role:</strong> ${user.role}</p>
        <p><strong>Status:</strong> ${user.status}</p>
        <p><strong>Document:</strong> ${user.document ? `<a href="${user.document}" target="_blank" download>View</a>` : 'None'}</p>
        <p><strong>Created At:</strong> ${new Date(user.createdAt).toLocaleString()}</p>
        <p><strong>Created By:</strong> ${user.createdBy || 'Unknown'}</p>
      `;
    } catch (err) {
      console.error(err);
      showError('‚ùå Could not load user info');
      setTimeout(() => {
        window.location.href = 'users-list.html';
      }, 1500);
    }
  }

  function showError(message) {
    const alertBox = document.createElement('div');
    alertBox.className = 'alert error';
    alertBox.textContent = message;
    document.body.prepend(alertBox);
    setTimeout(() => alertBox.remove(), 5000);
  }

  loadUser();
</script>
<script src="../admin-panel.js"></script>
<script src="../../backend-panel.js"></script>
</body>
</html>
